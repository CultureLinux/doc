
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://culturelinux.github.io/doc/web/nginx/">
      
      
        <link rel="prev" href="../../services/minio/">
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Nginx - CultureLinux</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nginx" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../.." title="CultureLinux" class="md-header__button md-logo" aria-label="CultureLinux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CultureLinux
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nginx
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CultureLinux" class="md-nav__button md-logo" aria-label="CultureLinux" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CultureLinux
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/environnement/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environement
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Historique
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stockage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/users/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilisateurs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/sudoers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sudoers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/permissions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Permissions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/crontab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cron
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/nmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/gnome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gnome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/rescue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rescue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/grub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GRUB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Rocky
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Rocky
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rocky/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rocky/firewalld/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Firewall
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rocky/locales/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Locales
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Debian
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Debian
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debian/packages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Packages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debian/msmtp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Email
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debian/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debian/snap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debian/ufw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UFW
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debian/nftables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NFTables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    RaspberryPi
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    RaspberryPi
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../raspberrypi/grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grafana
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    IA
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    IA
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ia/ollama/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ollama
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Databases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mariadb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MariaDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mongodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MongoDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/sqlserver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SqlServer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/influxdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    InfluxDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Monitoring
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/icinga/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Icinga
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/victoriametrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VictoriaMetrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/influxdb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    InfluxDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Grafana
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Virtualization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Virtualization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtualization/proxmox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Proxmox
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../virtualization/pve-automator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PVE automator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Infra As Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Infra As Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../iac/ansible/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ansible
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../iac/opentofu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenToFu
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Containers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Containers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/iptables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Iptables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/ssh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SSH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/wireguard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    WireGuard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/gpg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GPG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12_5" >
        
          
          <label class="md-nav__link" for="__nav_12_5" id="__nav_12_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    SSL/TLS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_12_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    SSL/TLS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/tls/mkcert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MKcert
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/tls/letsencrypt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lets Encrypt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/tls/lego/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lego
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/tls/stepca/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    StepCA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Git
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../git/gitlab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gitlab
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/minio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MinIO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" checked>
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Web
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    Web
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Nginx
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outillage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Outillage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ajout-du-tls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout du TLS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ajout du TLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-de-mkcert" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation de mkcert
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#positionnement-dans-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Positionnement dans nginx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generation-de-certificats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generation de certificats
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modification-de-la-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modification de la configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ouverture-du-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ouverture du port
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirection-automatique-vers-https-a-rajouter-dans-le-bloc-80-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        Redirection automatique vers https (a rajouter dans le bloc 80 - http)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajout-de-lautorie-de-certificats-dans-le-navigateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout de l'autorié de certificats dans le navigateur
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gestion-des-virtual-hosts-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gestion des virtual hosts (vhost)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestion des virtual hosts (vhost)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-de-repertoires" class="md-nav__link">
    <span class="md-ellipsis">
      
        Création de repertoires
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajout-de-linclude-dans-le-bloc-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout de l'include (dans le bloc http)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost-par-defaut" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost par defaut
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation-du-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activation du vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-des-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification des logs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hebergement-par-utilisateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hebergement par utilisateur
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hebergement par utilisateur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoriser-nginx-a-rentrer-dans-la-home" class="md-nav__link">
    <span class="md-ellipsis">
      
        Autoriser nginx a rentrer dans la /home
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifier-le-log-selinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifier le log selinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selinux-pour-utilisateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        SElinux pour utilisateurs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servir-un-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        Servir un port
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Servir un port">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exemple-avec-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemple avec python
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        SElinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repartiteur-de-charge-load-blancer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Répartiteur de charge (load blancer)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#le-cas-php" class="md-nav__link">
    <span class="md-ellipsis">
      
        Le cas php
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le cas php">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utilisateur-specifique" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utilisateur spécifique
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost nginx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#durcissement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Durcissement
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restriction-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restriction Ip
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restriction Ip">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basee-sur-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basée sur IP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basee-sur-maxmind" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basée sur maxmind
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basée sur maxmind">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#package-paywall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Package (paywall)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recompilation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recompilation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basee-sur-pays-par-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basée sur pays (par ip)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basée sur pays (par ip)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recupertion-des-cidr" class="md-nav__link">
    <span class="md-ellipsis">
      
        Récupértion des CIDR
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemple-de-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemple de vhost
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securite-modsecurity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sécurité (ModSecurity)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sécurité (ModSecurity)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajout-des-regles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout des règles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passage-en-mode-strict" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passage en mode strict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-de-la-configuration-modsecurity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Création de la configuration modsecurity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-de-configuration-pour-les-regles-rocky-linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fix de configuration pour les règles (rocky linux)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injection-de-modsecurity-dans-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Injection de modsecurity dans nginx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#desactivation-pour-une-zone-de-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Desactivation pour une zone de vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-de-regles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test de règles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regles-custom" class="md-nav__link">
    <span class="md-ellipsis">
      
        Règles custom
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Règles custom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exemples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocage-par-user-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Blocage par User-Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Blocage par User-Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocage-par-ip-pour-un-route" class="md-nav__link">
    <span class="md-ellipsis">
      
        Blocage par IP pour un route
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#outillage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Outillage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ajout-du-tls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout du TLS
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ajout du TLS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation-de-mkcert" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation de mkcert
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#positionnement-dans-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Positionnement dans nginx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generation-de-certificats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generation de certificats
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modification-de-la-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modification de la configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ouverture-du-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ouverture du port
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#redirection-automatique-vers-https-a-rajouter-dans-le-bloc-80-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        Redirection automatique vers https (a rajouter dans le bloc 80 - http)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajout-de-lautorie-de-certificats-dans-le-navigateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout de l'autorié de certificats dans le navigateur
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gestion-des-virtual-hosts-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Gestion des virtual hosts (vhost)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gestion des virtual hosts (vhost)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-de-repertoires" class="md-nav__link">
    <span class="md-ellipsis">
      
        Création de repertoires
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajout-de-linclude-dans-le-bloc-http" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout de l'include (dans le bloc http)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost-par-defaut" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost par defaut
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation-du-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activation du vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-des-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification des logs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hebergement-par-utilisateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hebergement par utilisateur
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hebergement par utilisateur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoriser-nginx-a-rentrer-dans-la-home" class="md-nav__link">
    <span class="md-ellipsis">
      
        Autoriser nginx a rentrer dans la /home
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifier-le-log-selinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifier le log selinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selinux-pour-utilisateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        SElinux pour utilisateurs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Activation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servir-un-port" class="md-nav__link">
    <span class="md-ellipsis">
      
        Servir un port
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Servir un port">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exemple-avec-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemple avec python
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selinux" class="md-nav__link">
    <span class="md-ellipsis">
      
        SElinux
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repartiteur-de-charge-load-blancer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Répartiteur de charge (load blancer)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#le-cas-php" class="md-nav__link">
    <span class="md-ellipsis">
      
        Le cas php
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Le cas php">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utilisateur-specifique" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utilisateur spécifique
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vhost-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Vhost nginx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#durcissement" class="md-nav__link">
    <span class="md-ellipsis">
      
        Durcissement
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restriction-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restriction Ip
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restriction Ip">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basee-sur-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basée sur IP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basee-sur-maxmind" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basée sur maxmind
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basée sur maxmind">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#package-paywall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Package (paywall)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recompilation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recompilation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basee-sur-pays-par-ip" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basée sur pays (par ip)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basée sur pays (par ip)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recupertion-des-cidr" class="md-nav__link">
    <span class="md-ellipsis">
      
        Récupértion des CIDR
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemple-de-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemple de vhost
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#securite-modsecurity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sécurité (ModSecurity)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sécurité (ModSecurity)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ajout-des-regles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ajout des règles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passage-en-mode-strict" class="md-nav__link">
    <span class="md-ellipsis">
      
        Passage en mode strict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-de-la-configuration-modsecurity" class="md-nav__link">
    <span class="md-ellipsis">
      
        Création de la configuration modsecurity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-de-configuration-pour-les-regles-rocky-linux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fix de configuration pour les règles (rocky linux)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injection-de-modsecurity-dans-nginx" class="md-nav__link">
    <span class="md-ellipsis">
      
        Injection de modsecurity dans nginx
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#desactivation-pour-une-zone-de-vhost" class="md-nav__link">
    <span class="md-ellipsis">
      
        Desactivation pour une zone de vhost
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-de-regles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test de règles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regles-custom" class="md-nav__link">
    <span class="md-ellipsis">
      
        Règles custom
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Règles custom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exemples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exemples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocage-par-user-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Blocage par User-Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Blocage par User-Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#blocage-par-ip-pour-un-route" class="md-nav__link">
    <span class="md-ellipsis">
      
        Blocage par IP pour un route
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="nginx">Nginx</h1>
<h2 id="installation">Installation</h2>
<div class="language-text highlight"><pre><span></span><code>dnf install nginx
systemctl enable nginx --now
firewall-cmd --add-port=80/tcp --permanent &amp;&amp; firewall-cmd --reload;
</code></pre></div>
<h2 id="outillage">Outillage</h2>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>vi /root/.bashrc
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>...
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>alias nginxtest=&#39;nginx -t&#39;
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>alias nginxstatus=&#39;service nginx status&#39;
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>alias nginxrestart=&#39;nginx -t &amp;&amp; service nginx restart&#39;
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>alias nginxreload=&#39;nginx -t &amp;&amp; service nginx reload&#39;
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a># --- Fonction pour activer un site ---
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>nginxenable() {
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    if [ -f &quot;/etc/nginx/sites-available/$1&quot; ]; then
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        ln -s &quot;/etc/nginx/sites-available/$1&quot; &quot;/etc/nginx/sites-enable/$1&quot; &amp;&amp; \
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        echo &quot;Site &#39;$1&#39; activé.&quot; &amp;&amp; \
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>        nginx -t &amp;&amp; \
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>        systemctl reload nginx
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    else
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        echo &quot;Erreur : le fichier &#39;$1&#39; n&#39;existe pas dans /etc/nginx/sites-available/&quot;
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    fi
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>}
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a># --- Fonction pour désactiver un site ---
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>nginxdisable() {
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    if [ -L &quot;/etc/nginx/sites-enable/$1&quot; ]; then
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>        rm &quot;/etc/nginx/sites-enable/$1&quot; &amp;&amp; \
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>        echo &quot;Site &#39;$1&#39; désactivé.&quot; &amp;&amp; \
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>        nginx -t &amp;&amp; \
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        systemctl reload nginx
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    else
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>        echo &quot;Erreur : le site &#39;$1&#39; n&#39;est pas activé.&quot;
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>    fi
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>}
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a># --- Autocomplétion pour nginxenable ---
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>_nginxenable_autocomplete() {
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>    local cur
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>    cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>    COMPREPLY=( $(compgen -W &quot;$(ls /etc/nginx/sites-available)&quot; -- &quot;$cur&quot;) )
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>}
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>complete -F _nginxenable_autocomplete nginxenable
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a># --- Autocomplétion pour nginxdisable ---
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>_nginxdisable_autocomplete() {
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>    local cur
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>    cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>    COMPREPLY=( $(compgen -W &quot;$(ls /etc/nginx/sites-enable)&quot; -- &quot;$cur&quot;) )
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>}
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>complete -F _nginxdisable_autocomplete nginxdisable
</span></code></pre></div></p>
<h2 id="test">Test</h2>
<div class="language-text highlight"><pre><span></span><code>netstat -tnlpv | grep 80
curl -s http://localhost | grep &#39;&lt;h1&gt;&#39; #sur le serveur web
curl -s http://$IP | grep &#39;&lt;h1&gt;&#39; #de l&#39;exterieur
</code></pre></div>
<h2 id="ajout-du-tls">Ajout du TLS</h2>
<h3 id="installation-de-mkcert">Installation de mkcert</h3>
<div class="language-text highlight"><pre><span></span><code>dnf install curl nss-tools wget
curl -s https://api.github.com/repos/FiloSottile/mkcert/releases/latest | grep browser_download_url | grep &#39;\linux-amd64&#39; | cut -d &#39;&quot;&#39; -f 4 | wget -i -
mv mkcert-v*-linux-amd64 /usr/bin/mkcert
chmod 750 /usr/bin/mkcert
mkcert -install
</code></pre></div>
<h3 id="positionnement-dans-nginx">Positionnement dans nginx</h3>
<div class="language-text highlight"><pre><span></span><code>mkdir /etc/nginx/ssl
cd /etc/nginx/ssl
</code></pre></div>
<h3 id="generation-de-certificats">Generation de certificats</h3>
<div class="language-text highlight"><pre><span></span><code>mkcert web.lab.clinux.fr
#Generate &quot;web.lab.clinux.fr.pem&quot; and &quot;web.lab.clinux.fr-key.pem&quot;.
mkcert web.lab.clinux.fr 192.168.1.211 127.0.0.1 ::1
#Generate &quot;web.lab.clinux.fr+3.pem&quot; and &quot;web.lab.clinux.fr+3-key.pem&quot;.
mkcert &quot;*.lab.clinux.fr&quot; 192.168.1.211 127.0.0.1 ::1
#Generate &quot;_wildcard.lab.clinux.fr+3.pem&quot; and &quot;_wildcard.lab.clinux.fr+3-key.pem&quot;.
</code></pre></div>
<h3 id="modification-de-la-configuration">Modification de la configuration</h3>
<p><code>vi /etc/nginx/nginx.conf</code></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>server {
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    listen       443 ssl http2 default;
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    listen       [::]:443 ssl http2 default;
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    server_name  _;
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    root         /usr/share/nginx/html;
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    ssl_certificate &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3.pem&quot;;
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    ssl_certificate_key &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3-key.pem&quot;;
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    ssl_session_cache shared:SSL:1m;
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    ssl_session_timeout  10m;
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    ssl_ciphers PROFILE=SYSTEM;
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    ssl_prefer_server_ciphers on;
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    error_page 404 /404.html;
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        location = /40x.html {
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    }
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>    error_page 500 502 503 504 /50x.html;
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        location = /50x.html {
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>    }
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>}
</span></code></pre></div>
<h3 id="ouverture-du-port">Ouverture du port</h3>
<div class="language-text highlight"><pre><span></span><code>firewall-cmd --add-port=443/tcp --permanent &amp;&amp; firewall-cmd --reload;
</code></pre></div>
<h3 id="redirection-automatique-vers-https-a-rajouter-dans-le-bloc-80-http">Redirection automatique vers https (a rajouter dans le bloc 80 - http)</h3>
<div class="language-text highlight"><pre><span></span><code>return 301 https://$host$request_uri;
</code></pre></div>
<h3 id="ajout-de-lautorie-de-certificats-dans-le-navigateur">Ajout de l'autorié de certificats dans le navigateur</h3>
<p>Récuperer le fichier <code>/root/.local/share/mkcert/rootCA.pem</code> et charger le en tant que certificat d'autorité</p>
<h2 id="gestion-des-virtual-hosts-vhost">Gestion des virtual hosts (vhost)</h2>
<h3 id="creation-de-repertoires">Création de repertoires</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>mkdir /etc/nginx/sites-available
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>mkdir /etc/nginx/sites-enable
</span></code></pre></div>
<h3 id="ajout-de-linclude-dans-le-bloc-http">Ajout de l'include (dans le bloc http)</h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>vi /etc/nginx/nginx.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>...
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>include /etc/nginx/sites-enable/*.conf;
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>...
</span></code></pre></div></p>
<h3 id="vhost-par-defaut">Vhost par defaut</h3>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>vi /etc/nginx/sites-available/web.lab.clinux.fr.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>server {
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    listen       80;
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    listen       [::]:80;
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    server_name  web.lab.clinux.fr;
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    return 301 https://$host$request_uri;
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>}
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>server {
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    listen       443 ssl http2;
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    listen       [::]:443 ssl http2;
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    server_name  web.lab.clinux.fr;
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    root         /usr/share/nginx/html;
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    access_log /var/log/nginx/web.lab.clinux.fr.access.log;
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    error_log  /var/log/nginx/web.lab.clinux.fr.log warn;
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    ssl_certificate &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3.pem&quot;;
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    ssl_certificate_key &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3-key.pem&quot;;
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>    ssl_session_cache shared:SSL:1m;
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>    ssl_session_timeout  10m;
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    ssl_ciphers PROFILE=SYSTEM;
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    ssl_prefer_server_ciphers on;
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    error_page 404 /custom_errors/404.html;
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>    error_page 500 502 503 504 /custom_errors/50x.html;
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>    location /custom_errors/ {
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>        alias /usr/share/nginx/html/;
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>        internal;
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>    }
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>    location / {
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>        try_files $uri $uri/ =404;
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>    }
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>}
</span></code></pre></div></p>
<h3 id="activation-du-vhost">Activation du vhost</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>    ln -s /etc/nginx/sites-available/web.lab.clinux.fr.conf /etc/nginx/sites-enable/web.lab.clinux.fr.conf
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    nginxreload
</span></code></pre></div>
<h3 id="verification-des-logs">Verification des logs</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>tail -f /var/log/nginx/web.lab.clinux.fr*.log
</span></code></pre></div>
<h2 id="hebergement-par-utilisateur">Hebergement par utilisateur</h2>
<h3 id="autoriser-nginx-a-rentrer-dans-la-home">Autoriser nginx a rentrer dans la /home</h3>
<div class="language-text highlight"><pre><span></span><code>usermod -aG static nginx
chmod 750 /home/static
</code></pre></div>
<h3 id="verifier-le-log-selinux">Verifier le log selinux</h3>
<div class="language-text highlight"><pre><span></span><code>tail -f /var/log/audit/audit.log
audit2why -all
</code></pre></div>
<h3 id="selinux-pour-utilisateurs">SElinux pour utilisateurs</h3>
<div class="language-text highlight"><pre><span></span><code>setsebool -P httpd_enable_homedirs 1
</code></pre></div>
<h3 id="vhost">Vhost</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>vi /etc/nginx/sites-available/web-static.lab.clinux.fr.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>server {
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    listen       80 ;
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    listen       [::]:80 ;
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    server_name  web-static.lab.clinux.fr;
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    return 301 https://$host$request_uri;
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>}
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>server {
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    listen       443 ssl http2 ;
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    listen       [::]:443 ssl http2 ;
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    server_name  web-static.lab.clinux.fr;
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    access_log /var/log/nginx/web-static.lab.clinux.fr.access.log;
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    error_log  /var/log/nginx/web-static.lab.clinux.fr.error.log warn;
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    ssl_certificate &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3.pem&quot;;
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>    ssl_certificate_key &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3-key.pem&quot;;
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>    ssl_session_cache shared:SSL:1m;
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    ssl_session_timeout  10m;
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    ssl_ciphers PROFILE=SYSTEM;
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>    ssl_prefer_server_ciphers on;
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>    root /home/static/html/;
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>    index index.html;
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>    error_page 404 /custom_errors/404.html;
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>    error_page 500 502 503 504 /custom_errors/50x.html;
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>    location /custom_errors/ {
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>        alias /usr/share/nginx/html/;
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>        internal;
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>    }
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>    location / {
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>        try_files $uri $uri/ =404;
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>    }
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>}
</span></code></pre></div>
<h3 id="activation">Activation</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ln -s /etc/nginx/sites-available/web-static.lab.clinux.fr.conf /etc/nginx/sites-enable/web-static.lab.clinux.fr.conf
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>nginx -t &amp;&amp; service nginx reload
</span></code></pre></div>
<h2 id="servir-un-port">Servir un port</h2>
<h3 id="exemple-avec-python">Exemple avec python</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>python3 -m http.server -b localhost 8080
</span></code></pre></div>
<h3 id="vhost_1">Vhost</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>server {
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    listen       80 ;
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    listen       [::]:80 ;
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    server_name  serv-port.lab.clinux.fr;
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    return 301 https://$host$request_uri;
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>}
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>server {
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    listen       443 ssl http2 ;
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>    listen       [::]:443 ssl http2 ;
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    server_name  serv-port.lab.clinux.fr;
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    access_log /var/log/nginx/serv-port.lab.clinux.fr.access.log;
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>    error_log  /var/log/nginx/serv-port.lab.clinux.fr.error.log warn;
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    ssl_certificate &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3.pem&quot;;
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>    ssl_certificate_key &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3-key.pem&quot;;
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>    ssl_session_cache shared:SSL:1m;
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>    ssl_session_timeout  10m;
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>    ssl_ciphers PROFILE=SYSTEM;
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>    ssl_prefer_server_ciphers on;
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>    error_page 404 /custom_errors/404.html;
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>    error_page 500 502 503 504 /custom_errors/50x.html;
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>    location /custom_errors/ {
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>        alias /usr/share/nginx/html/;
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>        internal;
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>    }
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>    location / {
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>        proxy_pass http://localhost:8080;
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>        try_files $uri $uri/ =404;
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>    }
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>}
</span></code></pre></div>
<h3 id="selinux">SElinux</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>setsebool -P httpd_can_network_connect 1
</span></code></pre></div>
<h3 id="repartiteur-de-charge-load-blancer">Répartiteur de charge (load blancer)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>upstream backend {
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    ip_hash;
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    server localhost:8080;
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    server localhost:8081;
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>}
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>server {
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    listen       80 ;
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    listen       [::]:80 ;
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    server_name  serv-port.lab.clinux.fr;
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    return 301 https://$host$request_uri;
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>}
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>server {
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>    listen       443 ssl http2 ;
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>    listen       [::]:443 ssl http2 ;
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>    server_name  serv-port.lab.clinux.fr;
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>    access_log /var/log/nginx/serv-port.lab.clinux.fr.access.log;
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>    error_log  /var/log/nginx/serv-port.lab.clinux.fr.error.log warn;
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>    ssl_certificate &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3.pem&quot;;
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>    ssl_certificate_key &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3-key.pem&quot;;
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>    ssl_session_cache shared:SSL:1m;
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>    ssl_session_timeout  10m;
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>    ssl_ciphers PROFILE=SYSTEM;
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>    ssl_prefer_server_ciphers on;
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>    error_page 404 /custom_errors/404.html;
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>    error_page 500 502 503 504 /custom_errors/50x.html;
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>    location /custom_errors/ {
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>        alias /usr/share/nginx/html/;
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>        internal;
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>    }
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>    location / {
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>        proxy_pass http://backend;
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>        try_files $uri $uri/ =404;
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>    }
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>}
</span></code></pre></div>
<h2 id="le-cas-php">Le cas php</h2>
<h3 id="utilisateur-specifique">Utilisateur spécifique</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>adduser dynamic
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>su - dynamic
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>mkdir /home/dynamic/www/
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>echo &quot;&lt;?php echo &#39;Contenu dynamique : &#39;. rand(); ?&gt;&quot; &gt;&gt; /home/dynamic/www/index.php
</span></code></pre></div>
<h3 id="installation_1">Installation</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>dnf install https://rpms.remirepo.net/enterprise/remi-release-9.rpm
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>dnf install php83-php-fpm
</span></code></pre></div>
<h3 id="configuration">Configuration</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>cd /etc/opt/remi/php83/php-fpm.d/
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>vi php.lab.clinux.fr.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>[php.lab.clinux.fr.conf]
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>; Chemin de l&#39;utilisateur et du groupe
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>user = dynamic
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>group = dynamic
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>; Chemin où sera exécuté php-fpm
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>listen = /var/run/php8.3-fpm.php.lab.clinux.fr.conf.socket
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>; Autorisations du socket
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>listen.owner = nginx
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>listen.group = nginx
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>listen.mode = 0660
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>; Configuration du répertoire du site
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>chdir = /
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>; Configuration des processus (adaptée selon la charge attendue)
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>pm = dynamic
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>pm.max_children = 10
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>pm.start_servers = 2
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>pm.min_spare_servers = 1
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>pm.max_spare_servers = 3
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>; Logs
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>php_admin_value[error_log] = /var/log/php/php8.3-fpm-php.lab.clinux.fr.conf.log
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>php_admin_flag[log_errors] = on
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>; Paramètres PHP personnalisés
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>php_value[memory_limit] = 256M
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>php_value[upload_max_filesize] = 50M
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>php_value[post_max_size] = 50M
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>php_value[max_execution_time] = 60
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>php_value[date.timezone] = Europe/Paris
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>systemctl enable php83-php-fpm.service --now
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>ll /var/run/php8.3*
</span></code></pre></div>
<h3 id="vhost-nginx">Vhost nginx</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>server {
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    listen       80 ;
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    listen       [::]:80 ;
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    server_name  php.lab.clinux.fr;
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>    return 301 https://$host$request_uri;
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>}
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>server {
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    listen       443 ssl http2 ;
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    listen       [::]:443 ssl http2 ;
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    server_name  php.lab.clinux.fr;
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    access_log /var/log/nginx/php.lab.clinux.fr.access.log;
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    error_log  /var/log/nginx/php.lab.clinux.fr.error.log warn;
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>    ssl_certificate &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3.pem&quot;;
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    ssl_certificate_key &quot;/etc/nginx/ssl/_wildcard.lab.clinux.fr+3-key.pem&quot;;
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    ssl_session_cache shared:SSL:1m;
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>    ssl_session_timeout  10m;
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    ssl_ciphers PROFILE=SYSTEM;
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>    ssl_prefer_server_ciphers on;
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>    root /home/dynamic/www/;
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>    index index.php;
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>    location ~ \.php$ {
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>        include /etc/nginx/fastcgi.conf ;
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>        fastcgi_pass unix:/var/run/php8.3-fpm.php.lab.clinux.fr.conf.socket;
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>        fastcgi_split_path_info ^(.+\.php)(/.*)$;
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>        fastcgi_param HTTPS $https;
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>        fastcgi_buffering off;
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>    }
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>}
</span></code></pre></div>
<h3 id="durcissement">Durcissement</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>php_admin_value[open_basedir] = /home/dynamic/www/:/tmp/
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>php_admin_value[disable_functions] = exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,dl,fsockopen,pfsockopen
</span></code></pre></div>
<h2 id="restriction-ip">Restriction Ip</h2>
<h3 id="basee-sur-ip">Basée sur IP</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>allow 192.168.1.143;
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>allow 192.168.1.142;
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>allow 192.168.1.0/24;
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>deny all;
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>error_page 403 https://www.youtube.com/watch?v=dQw4w9WgXcQ&amp;list=RDdQw4w9WgXcQ&amp;start_radio=1 ;
</span></code></pre></div>
<h3 id="basee-sur-maxmind">Basée sur maxmind</h3>
<h4 id="package-paywall">Package (paywall)</h4>
<ul>
<li>https://docs.nginx.com/nginx/admin-guide/dynamic-modules/geoip2/</li>
</ul>
<h4 id="recompilation">Recompilation</h4>
<ul>
<li>https://github.com/leev/ngx_http_geoip2_module</li>
</ul>
<h3 id="basee-sur-pays-par-ip">Basée sur pays (par ip)</h3>
<h4 id="recupertion-des-cidr">Récupértion des CIDR</h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>mkdir /etc/nginx/nginx-country
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>wget http://firewalliplists.gypthecat.com/lists/nginx/nginx-countries.conf.zip
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>unzip nginx-countries.conf.zip -d /etc/nginx/nginx-country
</span></code></pre></div>
<h4 id="exemple-de-vhost">Exemple de vhost</h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>...
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>include nginx-country/FR-allow.conf;
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>include nginx-country/DE-deny.conf;
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>deny all;
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>...
</span></code></pre></div>
<h2 id="securite-modsecurity">Sécurité (ModSecurity)</h2>
<h3 id="installation_2">Installation</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>dnf install epel-release
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>dnf install nginx-mod-modsecurity
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>mkdir -p /etc/nginx/modsecurity
</span></code></pre></div>
<h3 id="ajout-des-regles">Ajout des règles</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>cd /etc/nginx/modsecurity
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>curl -sL https://github.com/coreruleset/coreruleset/archive/refs/tags/v4.18.0.tar.gz | tar xz 
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>ln -s coreruleset-4.18.0 coreruleset
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>cd coreruleset
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>cp crs-setup.conf.example crs-setup.conf
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>curl -so /etc/nginx/modsecurity/modsecurity.conf https://raw.githubusercontent.com/SpiderLabs/ModSecurity/v3/master/modsecurity.conf-recommended 
</span></code></pre></div>
<h3 id="passage-en-mode-strict">Passage en mode strict</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>sed -i &#39;s/SecRuleEngine DetectionOnly/SecRuleEngine On/&#39; /etc/nginx/modsecurity/modsecurity.conf
</span></code></pre></div>
<h3 id="creation-de-la-configuration-modsecurity">Création de la configuration modsecurity</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>vi /etc/nginx/modsecurity/main.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Include /etc/nginx/modsecurity/modsecurity.conf
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>Include /etc/nginx/modsecurity/coreruleset/crs-setup.conf
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>Include /etc/nginx/modsecurity/coreruleset/rules/*.conf
</span></code></pre></div>
<h3 id="fix-de-configuration-pour-les-regles-rocky-linux">Fix de configuration pour les règles (rocky linux)</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>sed -i &#39;s/^\(SecUnicodeMapFile unicode.mapping 20127\)/# \1/&#39; /etc/nginx/modsecurity/modsecurity.conf
</span></code></pre></div>
<h3 id="injection-de-modsecurity-dans-nginx">Injection de modsecurity dans nginx</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>vi /etc/nginx/nginx.conf
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>...
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>http {
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    # Activer ModSecurity globalement
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>    modsecurity on;
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>    modsecurity_rules_file /etc/nginx/modsecurity/main.conf;
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>...
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>systemctl restart nginx
</span></code></pre></div>
<h3 id="desactivation-pour-une-zone-de-vhost">Desactivation pour une zone de vhost</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>location /api/legacy {
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>    modsecurity off;
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>    proxy_pass http://backend;
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>}
</span></code></pre></div>
<h3 id="test-de-regles">Test de règles</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>&lt;!doctype html&gt;
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>&lt;html lang=&quot;fr&quot;&gt;
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>&lt;head&gt;
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>  &lt;meta charset=&quot;utf-8&quot; /&gt;
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot; /&gt;
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>  &lt;title&gt;ModSecurity Test&lt;/title&gt;
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>  &lt;style&gt;
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>    body { font-family: system-ui, -apple-system, &quot;Segoe UI&quot;, Roboto, &quot;Helvetica Neue&quot;, Arial; padding: 24px; max-width:900px; }
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>    code { background:#f4f4f4; padding:2px 6px; border-radius:4px; }
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>    .links a { display:block; margin:8px 0; text-decoration:none; }
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>    .warn { color:#b22222; font-weight:700; }
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>  &lt;/style&gt;
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>&lt;/head&gt;
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>&lt;body&gt;
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>  &lt;h1&gt;ModSecurity WAF — Page de test&lt;/h1&gt;
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>  &lt;p&gt;Page destinée à déclencher des règles ModSecurity / OWASP CRS en &lt;strong&gt;mode blocage&lt;/strong&gt;.&lt;/p&gt;
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>  &lt;h2&gt;Tests (clique pour exécuter)&lt;/h2&gt;
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>  &lt;div class=&quot;links&quot;&gt;
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>    &lt;p&gt;&lt;span class=&quot;warn&quot;&gt;XSS (payload encodé dans l&#39;URL) — test basique :&lt;/span&gt;&lt;/p&gt;
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>    &lt;a href=&quot;/?test=%3Cscript%3Ealert(&#39;XSS&#39;)%3C%2Fscript%3E&quot; rel=&quot;noopener noreferrer&quot;&gt;/?test=%3Cscript%3Ealert(&#39;XSS&#39;)%3C%2Fscript%3E&lt;/a&gt;
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>    &lt;p&gt;&lt;span class=&quot;warn&quot;&gt;SQL Injection (simple payload encodé) :&lt;/span&gt;&lt;/p&gt;
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>    &lt;a href=&quot;/?id=1%27%20OR%20%271%27%3D%271&quot; rel=&quot;noopener noreferrer&quot;&gt;/?id=1%27%20OR%20%271%27%3D%271&lt;/a&gt;
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>
</span><span id="__span-38-26"><a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>  &lt;/div&gt;
</span><span id="__span-38-27"><a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>
</span><span id="__span-38-28"><a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>  &lt;h2&gt;Commandes curl utiles&lt;/h2&gt;
</span><span id="__span-38-29"><a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>  &lt;pre&gt;
</span><span id="__span-38-30"><a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a>    &lt;code&gt;# Scan sqlmap
</span><span id="__span-38-31"><a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>        curl -k -A sqlmap  https://web-static.lab.clinux.fr
</span><span id="__span-38-32"><a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a>    &lt;/code&gt;
</span><span id="__span-38-33"><a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a>    &lt;code&gt;# Protection /admin
</span><span id="__span-38-34"><a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a>        curl -k https://web-static.lab.clinux.fr/admin
</span><span id="__span-38-35"><a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a>    &lt;/code&gt;
</span><span id="__span-38-36"><a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>  &lt;/pre&gt;
</span><span id="__span-38-37"><a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a>
</span><span id="__span-38-38"><a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a>  &lt;p style=&quot;margin-top:20px;&quot;&gt;Amuse-toi (ou pleure), et check les logs. 😈🔍&lt;/p&gt;
</span><span id="__span-38-39"><a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a>&lt;/body&gt;
</span><span id="__span-38-40"><a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a>&lt;/html&gt;
</span></code></pre></div>
<h3 id="regles-custom">Règles custom</h3>
<h4 id="structure">Structure</h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>SecRule VARIABLES &quot;OPERATOR&quot; &quot;ACTIONS&quot;
</span></code></pre></div>
<ul>
<li>VARIABLES : Où chercher (ARGS, HEADERS, REQUEST_BODY...)</li>
<li>OPERATOR : Comment chercher (regex, @rx, @contains...)</li>
<li>ACTIONS : Que faire (log, deny, pass, block...)</li>
</ul>
<h4 id="exemples">Exemples</h4>
<p><a href="https://coreruleset.org/docs/3-about-rules/creating/">Guide d'écriture de règles</a></p>
<h5 id="blocage-par-user-agent">Blocage par User-Agent</h5>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a># Bloquer les scans sqlmap
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a># Test : curl -A sqlmap  https://web-static.lab.clinux.fr
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>SecRule REQUEST_HEADERS:User-Agent &quot;@contains sqlmap&quot; \
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>    &quot;id:10001,\
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>    phase:1,\
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    deny,\
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>    status:403,\
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    log,\
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    msg:&#39;SQLMap bot détecté&#39;&quot;
</span></code></pre></div>
<h6 id="blocage-par-ip-pour-un-route">Blocage par IP pour un route</h6>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a># Bloquer les accès /admin pour une IP
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a># Test : curl -k  https://web-static.lab.clinux.fr/admin
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>SecRule REQUEST_URI &quot;@rx ^/admin&quot; \
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    &quot;id:10002,\
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>    phase:1,\
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>    deny,\
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>    status:403,\
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>    chain,\
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>    log,\
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>    msg:&#39;Admin access from unauthorized IP &#39;&quot;
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>    SecRule REMOTE_ADDR &quot;!@ipMatch 192.168.1.143&quot;
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>